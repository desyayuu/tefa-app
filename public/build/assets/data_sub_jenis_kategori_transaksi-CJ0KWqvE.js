import{s as n}from"./components-C-5l6dZl.js";$(document).ready(function(){let t;setTimeout(function(){try{const s=document.getElementById("modalEditData");s&&typeof bootstrap<"u"&&(t=new bootstrap.Modal(s,{backdrop:"static",keyboard:!1}))}catch(s){console.warn("Bootstrap modal initialization failed:",s),t=null}},100),$("#modalTambahData").on("show.bs.modal",function(){console.log("Modal tambah dibuka"),u("#jenis_transaksi_id"),c("#jenis_keuangan_tefa_id")}),$("#modalEditData").on("show.bs.modal",function(){console.log("Modal edit dibuka"),u("#edit_jenis_transaksi_id"),c("#edit_jenis_keuangan_tefa_id")}),$(document).on("click",".btn-edit",function(s){s.preventDefault(),s.stopPropagation();const a=$(this).data("id");if(console.log("Edit button clicked, ID:",a),!a){n.errorMessage("ID tidak ditemukan");return}$.ajax({url:`/koordinator/data-sub-kategori-transaksi/get-sub-jenis-kategori/${a}`,type:"GET",beforeSend:function(){console.log("Loading edit data...")},success:function(o){if(console.log("Edit data response:",o),o.status==="success"){const e=o.data;$("#formEditData")[0].reset(),$("#edit_id").val(e.sub_jenis_transaksi_id),$("#edit_nama_sub_jenis_transaksi").val(e.nama_sub_jenis_transaksi),$("#edit_keterangan").val(e.deskripsi_sub_jenis_transaksi||""),Promise.all([u("#edit_jenis_transaksi_id"),c("#edit_jenis_keuangan_tefa_id")]).then(function(){setTimeout(function(){$("#edit_jenis_transaksi_id").val(e.jenis_transaksi_id),$("#edit_jenis_keuangan_tefa_id").val(e.jenis_keuangan_tefa_id),console.log("Dropdown values set:",{jenis_transaksi_id:e.jenis_transaksi_id,jenis_keuangan_tefa_id:e.jenis_keuangan_tefa_id})},300)}),$("#formEditData").attr("action",`/koordinator/data-sub-kategori-transaksi/update-sub-jenis-kategori/${a}`);try{t?t.show():$("#modalEditData").modal("show")}catch(r){console.warn("Modal show error:",r),$("#modalEditData").addClass("show").css("display","block"),$("body").addClass("modal-open"),$(".modal-backdrop").remove(),$('<div class="modal-backdrop fade show"></div>').appendTo("body")}}else n.errorMessage("Error: "+o.message)},error:function(o,e,r){console.error("Error loading edit data:",o);let i="Error loading data";o.responseJSON&&o.responseJSON.message?i=o.responseJSON.message:o.status===404?i="Data tidak ditemukan":o.status===500&&(i="Server error"),n.errorMessage(i)}})}),$(document).on("click",".btn-delete",function(s){s.preventDefault(),s.stopPropagation();const a=$(this).data("id");if(console.log("Delete button clicked, ID:",a),!a){n.errorMessage("ID tidak ditemukan");return}n.confirmationDelete("Apakah Anda yakin ingin menghapus data ini?").then(o=>{o.isConfirmed&&d(a)})});function d(s){$.ajax({url:`/koordinator/data-sub-kategori-transaksi/delete-sub-jenis-kategori/${s}`,type:"DELETE",data:{_token:$('meta[name="csrf-token"]').attr("content")},beforeSend:function(){console.log("Deleting data...")},success:function(a){console.log("Delete response:",a),a.status==="success"?(n.successMessage("Data Sub Jenis Transaksi berhasil dihapus"),setTimeout(()=>{window.location.reload()},1500)):n.errorMessage(a.message)},error:function(a,o,e){console.error("Error deleting data:",a),n.errorMessage("Error deleting data: "+(a.responseJSON?a.responseJSON.message:e))}})}$(document).on("click",'[data-bs-dismiss="modal"]',function(){if($(this).closest(".modal").attr("id")==="modalEditData")try{t?t.hide():$("#modalEditData").modal("hide")}catch{$("#modalEditData").removeClass("show").css("display","none"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove()}}),$("#formTambahData").on("submit",function(s){s.preventDefault(),console.log("Form tambah submitted"),$.ajax({url:$(this).attr("action"),type:"POST",data:$(this).serialize(),beforeSend:function(){console.log("Saving new data...")},success:function(a){a.status==="success"?($("#modalTambahData").modal("hide"),n.successMessage("Data Sub Jenis Transaksi berhasil ditambahkan"),setTimeout(()=>{window.location.reload()},1500)):n.errorMessage(a.message)},error:function(a,o,e){if(console.error("Error saving data:",a),a.status===422){const r=a.responseJSON.errors;let i=`Validation Error:
`;for(let l in r)i+="- "+r[l][0]+`
`;n.errorMessage(i)}else n.errorMessage("Error saving data: "+e)}})}),$("#formEditData").on("submit",function(s){s.preventDefault(),console.log("Form edit submitted"),console.log("Form action:",$(this).attr("action")),$.ajax({url:$(this).attr("action"),type:"POST",data:$(this).serialize(),beforeSend:function(){console.log("Updating data...")},success:function(a){if(console.log("Update response:",a),a.status==="success"){try{t?t.hide():$("#modalEditData").modal("hide")}catch{$("#modalEditData").removeClass("show").css("display","none"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove()}n.successMessage("Data Sub Jenis Transaksi berhasil diperbarui"),setTimeout(()=>{window.location.reload()},1500)}else n.errorMessage(a.message)},error:function(a,o,e){if(console.error("Error updating data:",a),a.status===422){const r=a.responseJSON.errors;let i=`Validation Error:
`;for(let l in r)i+="- "+r[l][0]+`
`;n.errorMessage(i)}else n.errorMessage("Error updating data: "+e)}})})});function u(t){return new Promise((d,s)=>{$.ajax({url:"/koordinator/data-sub-kategori-transaksi/get-jenis-transaksi",type:"GET",success:function(a){$(t).empty(),$(t).append('<option value="">Pilih Jenis Transaksi</option>'),a.status==="success"?($.each(a.data,function(o,e){$(t).append('<option value="'+e.jenis_transaksi_id+'">'+e.nama_jenis_transaksi+"</option>")}),console.log("Jenis transaksi loaded for",t),d(a)):s("Failed to load jenis transaksi")},error:function(a,o,e){console.error("Error loading jenis transaksi:",e),n.errorMessage("Error loading jenis transaksi"),s(e)}})})}function c(t){return new Promise((d,s)=>{$.ajax({url:"/koordinator/data-sub-kategori-transaksi/get-jenis-keuangan-tefa",type:"GET",success:function(a){$(t).empty(),$(t).append('<option value="">Pilih Kategori Transaksi</option>'),a.status==="success"?($.each(a.data,function(o,e){$(t).append('<option value="'+e.jenis_keuangan_tefa_id+'">'+e.nama_jenis_keuangan_tefa+"</option>")}),console.log("Jenis keuangan tefa loaded for",t),d(a)):s("Failed to load jenis keuangan tefa")},error:function(a,o,e){console.error("Error loading kategori transaksi:",e),n.errorMessage("Error loading kategori transaksi"),s(e)}})})}
