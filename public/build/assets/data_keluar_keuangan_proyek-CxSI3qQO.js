import{s as w}from"./components-C-5l6dZl.js";$(document).ready(function(){$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),J(),A(),document.getElementById("tableKeuangan")&&(console.log("Detail page detected, loading transaction data"),_(1,{}),X(),le(),z()),te(),ae(),$("#edit_file_keuangan_tefa").change(function(){S()&&D()}),document.getElementById("tableKeuangan")&&(console.log("Detail page detected, initializing filters"),fe())});function J(){const e=document.querySelectorAll(".currency-input");console.log("Currency inputs found:",e.length),e.forEach(a=>{a.addEventListener("input",function(t){let n=this.value.replace(/\D/g,"");n&&(n=parseInt(n,10).toLocaleString("id-ID")),this.value=n})})}function A(){const e=document.querySelectorAll(".view-project-btn");console.log("View project buttons found:",e.length),e.forEach(a=>{a.addEventListener("click",function(t){t.preventDefault();const n=this.dataset.proyekId;if(console.log("Button clicked for proyek ID:",n),!n){console.error("No proyek ID found in clicked element");return}x(),console.log("Navigating to detail page for proyek ID:",n),window.location.href=`/koordinator/data-keluar-keuangan-proyek/${n}`})}),document.addEventListener("click",function(a){const t=a.target.closest(".view-project-btn");if(t){a.preventDefault();const n=t.dataset.proyekId;console.log("Delegated click handler triggered for proyek ID:",n),n&&(x(),window.location.href=`/koordinator/data-keluar-keuangan-proyek/${n}`)}})}function x(){const e=document.getElementById("loadingIndicator");e?(e.classList.remove("d-none"),console.log("Loading indicator shown")):console.log("Loading indicator element not found")}function T(e){const a=document.getElementById("keuanganTefaPaginationInfo");a&&(a.textContent=`Showing ${e.from} to ${e.to} of ${e.total} entries`)}function X(){const e=document.getElementById("addTransactionForm");e&&(document.getElementById("addTransactionModal").addEventListener("shown.bs.modal",function(){const t=document.getElementById("jenis_transaksi_id"),n=document.getElementById("jenis_keuangan_tefa_id");document.getElementById("hidden_jenis_transaksi_id").value=t.value,document.getElementById("hidden_jenis_keuangan_tefa_id").value=n.value;const s=document.getElementById("tanggal_transaksi");if(!s.value){const i=new Date().toISOString().split("T")[0];s.value=i}}),e.addEventListener("submit",function(t){t.preventDefault();const n=document.getElementById("jenis_transaksi_id"),s=document.getElementById("jenis_keuangan_tefa_id");if(document.getElementById("hidden_jenis_transaksi_id").value=n.value,document.getElementById("hidden_jenis_keuangan_tefa_id").value=s.value,$("#isSinglePengeluaran").val()==="1")E()&&I();else{if(JSON.parse($("#pengeluaran_JsonData").val()).length===0){$("#form_pengeluaran_error").removeClass("d-none").text("Tambahkan minimal satu item ke daftar sebelum menyimpan.");return}I()}}))}function H(){document.querySelectorAll(".btn-action-detail-keuangan").forEach(a=>{a.addEventListener("click",function(){const t=this.dataset.id;console.log("Edit button clicked for transaction ID:",t),t&&G(t)})})}function G(e){var s;console.log("Loading transaction detail for edit:",e),$("#editLoadingState").show(),$("#editFormContent").hide(),$("#form_keuangan_tefa_edit_error").addClass("d-none").text("");const a=(s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"),t=document.querySelector('input[name="proyek_id"]'),n=t==null?void 0:t.value;if(!n){console.error("Could not find proyek_id"),c("Tidak dapat menemukan ID proyek");return}fetch(`/koordinator/data-keluar-keuangan-proyek/${n}/transaksi/${e}/detail`,{method:"GET",headers:{"X-CSRF-TOKEN":a||"",Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(i=>{if(!i.ok)throw new Error("Network response was not ok: "+i.status);return i.json()}).then(i=>{console.log("Transaction detail loaded:",i),i.success&&i.data?se(i.data):c(i.message||"Gagal memuat data transaksi")}).catch(i=>{console.error("Error loading transaction detail:",i),c("Gagal memuat data transaksi. Silakan coba lagi.")}).finally(()=>{$("#editLoadingState").hide(),$("#editFormContent").show()})}function V(e,a){const t=$("#edit_file_preview_container"),n=e.toLowerCase().split(".").pop(),i=`
        <div class="mt-2 p-2 border rounded">
            <div class="d-flex align-items-center justify-content-between">
                <div class="d-flex align-items-center">
                    <i class="${N(n)} fa-lg me-2"></i>
                    <div>
                        <small class="text-muted">File saat ini:</small><br>
                        <a href="${a}" target="_blank" >
                            ${e}</a>
                    </div>
                </div>

            </div>
            <small class="text-muted">Pilih file baru jika ingin mengganti</small>
        </div>
    `;t.html(i)}function S(){const e=document.getElementById("edit_file_keuangan_tefa");if($(e).removeClass("is-invalid"),$("#edit_file_keuangan_tefa_error").text(""),!e.files||e.files.length===0)return console.log("No file selected for edit"),!0;const a=e.files[0];console.log("Edit file details:",{name:a.name,size:a.size,type:a.type});const t=10*1024*1024;if(a.size>t)return console.error("Edit file too large:",a.size),$(e).addClass("is-invalid"),$("#edit_file_keuangan_tefa_error").text("Ukuran file maksimal 10MB"),!1;const s=a.name.toLowerCase().split(".").pop();return["pdf","doc","docx","xls","xlsx","ppt","pptx","jpg","jpeg","png"].includes(s)?!0:($(e).addClass("is-invalid"),$("#edit_file_keuangan_tefa_error").text("Format file tidak didukung. Format yang diizinkan: PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX, JPG, JPEG, PNG"),!1)}function U(e){if(e===0)return"0 Bytes";const a=1024,t=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(e)/Math.log(a));return parseFloat((e/Math.pow(a,n)).toFixed(2))+" "+t[n]}function D(){const e=document.getElementById("edit_file_keuangan_tefa"),a=$("#edit_file_preview_container");if(!e.files||e.files.length===0)return;const t=e.files[0],n=t.name.toLowerCase().split(".").pop(),s=U(t.size);if(["jpg","jpeg","png"].includes(n)){const i=new FileReader;i.onload=function(r){const l=`
                <div class="image-preview text-center">
                    <img src="${r.target.result}" class="img-thumbnail" style="max-height: 200px; max-width: 100%;" alt="Preview">
                </div>
            `;a.html(l)},i.readAsDataURL(t)}else{const i=`
        <div class="mt-2 p-2 border rounded">
            <div class="d-flex align-items-center justify-content-between">
                <div class="d-flex align-items-center">
                    <div class="file-preview-card border rounded p-2 bg-white">
                        <div class="d-flex align-items-center">
                            <div class="file-details flex-grow-1">
                                <p class="mb-1 fw-bold text-truncate" title="${t.name}">${t.name}</p>
                                <small class="text-muted">${s} â€¢ ${n.toUpperCase()}</small>
                            </div>
                        </div>
                        <div id="edit-file-preview-content" class="mt-2"></div>
                    </div>
                </div>
            </div>
        </div>
        `;a.html(i)}}function L(e){return e.trim().length>0&&e.trim().length<=255}function B(){const e=document.getElementById("bukti_transaksi");if($(e).removeClass("is-invalid"),$("#bukti_transaksi_error").text(""),!e.files||e.files.length===0)return console.log("No file selected"),!0;const a=e.files[0];console.log("File details:",{name:a.name,size:a.size,type:a.type});const t=10*1024*1024;if(a.size>t)return console.error("File too large:",a.size),$(e).addClass("is-invalid"),$("#bukti_transaksi_error").text("Ukuran file maksimal 10MB"),!1;const s=a.name.toLowerCase().split(".").pop(),i=["pdf","doc","docx","xls","xlsx","ppt","pptx","jpg","jpeg","png"];return console.log("File validation:",{extension:s,isAllowedExtension:i.includes(s)}),i.includes(s)?!0:($(e).addClass("is-invalid"),$("#bukti_transaksi_error").text("Format file tidak didukung. Format yang diizinkan: PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX, JPG, JPEG, PNG"),!1)}function W(){const e=document.getElementById("bukti_transaksi"),a=document.getElementById("file_preview_container")||$('<div id="file_preview_container" class="mt-2"></div>').insertAfter(e).get(0);if($(a).empty(),!e.files||e.files.length===0){console.log("No file selected for preview");return}const t=e.files[0];console.log("Preview file:",t.name,t.type,t.size);const n=t.name.toLowerCase().split(".").pop();if(["jpg","jpeg","png"].includes(n)){const s=new FileReader;s.onload=function(i){const r=document.createElement("img");r.src=i.target.result,r.className="img-thumbnail mt-2",r.style.maxHeight="150px",a.appendChild(r)},s.readAsDataURL(t)}else{const s=N(n);$(a).html(`
            <div class="d-flex align-items-center mt-2">
                <i class="${s} fa-2x me-2"></i>
                <span>${t.name}</span>
            </div>
        `)}}function N(e){switch(e){case"pdf":return"bi bi-file-pdf";case"doc":case"docx":return"bi bi-file-word";case"xls":case"xlsx":return"bi bi-file-excel";case"ppt":case"pptx":return"bi bi-file-ppt";case"jpg":case"jpeg":case"png":return"bi bi-file-image";default:return"bi bi-file-earmark"}}function Z(e){console.log("Removing item with ID:",e);let a=JSON.parse($("#pengeluaran_JsonData").val());console.log("Current list before removal:",a);const t=String(e);a=a.filter(n=>String(n.id)!==t),console.log("List after removal:",a),$("#pengeluaran_JsonData").val(JSON.stringify(a)),window.pengeluaranFiles&&window.pengeluaranFiles[t]&&(delete window.pengeluaranFiles[t],console.log(`File associated with item ${t} has been removed from storage`)),$(`#item-${e}`).remove(),a.length===0&&($("#isSinglePengeluaran").val("1"),$("#daftarPengeluaran").html(`
            <tr id="emptyRowPengeluaran">
                <td colspan="5" class="text-center">Belum ada pengeluaran yang ditambahkan ke daftar</td>
            </tr>
        `)),$("#form_pengeluaran_error").removeClass("d-none alert-danger").addClass("alert-success").text("Item berhasil dihapus dari daftar."),setTimeout(function(){$("#form_pengeluaran_error").addClass("d-none").removeClass("alert-success")},3e3)}function Q(e){let a=String(e).replace(/\D/g,"");return a?a.replace(/\B(?=(\d{3})+(?!\d))/g,"."):"0"}function j(){w.successMessage("Dana pengeluaran berhasi disimpan"),$("#addTransactionForm")[0].reset(),$("#btnSimpanPengeluaran").prop("disabled",!1).html("Simpan"),$("#form_pengeluaran_error").addClass("d-none").text(""),$(".is-invalid").removeClass("is-invalid"),$("#bukti_transaksi").val(""),$("#file_preview_container").empty(),window.pengeluaranFiles&&(window.pengeluaranFiles={}),$("#pengeluaran_JsonData").val("[]"),$("#daftarPengeluaran").html('<tr id="emptyRowPengeluaran"><td colspan="5" class="text-center">Belum ada pengeluaran yang ditambahkan ke daftar</td></tr>'),$("#isSinglePengeluaran").val("1"),$("#addTransactionModal").modal("hide"),_(1)}function F(e,a,t,n){var s,i,r,l;if($("#btnSimpanPengeluaran").prop("disabled",!1).html("Simpan"),console.error("Submit error:",{status:e.status,statusText:e.statusText,responseText:e.responseText,error:t}),e.status===419)$("#form_pengeluaran_error").removeClass("d-none").addClass("alert-danger").text("Token keamanan tidak valid. Silakan refresh halaman dan coba lagi."),setTimeout(function(){window.location.reload()},3e3);else if(e.status===422){const o=((s=e.responseJSON)==null?void 0:s.errors)||{};$(".is-invalid").removeClass("is-invalid");let d=!1;for(const u in o){const g=o[u][0],f=$(`#${u}`),k=$(`#${u}_error`);f.length&&k.length&&(f.addClass("is-invalid"),k.text(g),d=!0)}d?$("#form_pengeluaran_error").removeClass("d-none").addClass("alert-danger").text("Terdapat kesalahan pada form. Silakan periksa kembali."):$("#form_pengeluaran_error").removeClass("d-none").addClass("alert-danger").text("Validasi gagal: "+(((i=e.responseJSON)==null?void 0:i.message)||"Silakan periksa data yang diinput."))}else if(e.status===500){const o=((r=e.responseJSON)==null?void 0:r.message)||"Terjadi kesalahan pada server.";$("#form_pengeluaran_error").removeClass("d-none").addClass("alert-danger").text("Error Server: "+o)}else if(e.status===0)$("#form_pengeluaran_error").removeClass("d-none").addClass("alert-danger").text("Tidak dapat terhubung ke server. Periksa koneksi internet Anda.");else{const o=((l=e.responseJSON)==null?void 0:l.message)||e.statusText||"Terjadi kesalahan yang tidak diketahui.";$("#form_pengeluaran_error").removeClass("d-none").addClass("alert-danger").text(`Error (${e.status}): ${o}`)}}function Y(){document.querySelectorAll(".btn-action-delete").forEach(a=>{a.addEventListener("click",function(){const t=this.dataset.id;w.confirmationDelete("Apakah Anda yakin ingin menghapus transaksi ini?","Data yang dihapus tidak dapat dikembalikan.").then(n=>{n.isConfirmed&&ee(t)})})})}function ee(e){const a=document.querySelector('meta[name="csrf-token"]').getAttribute("content");Swal.fire({title:"Sedang menghapus...",allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!1,didOpen:()=>{Swal.showLoading()}}),fetch(`/koordinator/data-keluar-keuangan-proyek/hapus-transaksi/${e}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":a,Accept:"application/json","Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}}).then(t=>t.json()).then(t=>{t.success?Swal.fire({title:"Berhasil!",text:"Transaksi berhasil dihapus",icon:"success",confirmButtonText:"OK"}).then(()=>{_()}):Swal.fire({title:"Gagal!",text:t.message||"Gagal menghapus transaksi",icon:"error",confirmButtonText:"OK"})}).catch(t=>{console.error("Error deleting transaction:",t),Swal.fire({title:"Error!",text:"Terjadi kesalahan. Silakan coba lagi.",icon:"error",confirmButtonText:"OK"})})}function ae(){const e=document.getElementById("subkategoriData"),a=document.getElementById("subkategoriContainer");if(e&&a)try{const t=JSON.parse(e.textContent);if(console.log("Subkategori data found:",t.length,"items"),t&&t.length>0){a.style.display="block";const n=a.querySelector('label[for="subkategori_pengeluaran_id"]');n&&!n.querySelector(".text-danger")&&(n.querySelector(".text-danger")||(n.innerHTML=n.innerHTML.replace("Kategori Pengeluaran",'Kategori Pengeluaran <span class="text-danger">*</span>'))),console.log("Subkategori dropdown shown - data available and required")}else a.style.display="none",console.log("Subkategori dropdown hidden - no data available")}catch(t){console.error("Error parsing subkategori data:",t),a.style.display="none"}else console.log("Subkategori elements not found, hiding container"),a&&(a.style.display="none")}function te(){const e=new Date().toISOString().split("T")[0];$("#tanggal_transaksi").val(e),$("#pengeluaran_JsonData").val("[]"),$("#isSinglePengeluaran").val("1"),$("#bukti_transaksi").change(function(){B(),W()}),$("#btnTambahkanKeDaftarPengeluaran").off("click").on("click",function(){const a=$(this).text();$(this).prop("disabled",!0).html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Menambahkan...');const t=ie();$(this).prop("disabled",!1).text(a),t||setTimeout(function(){$(".is-invalid:first").focus()},100)}),$(document).on("click",".btn-remove-item",function(){const a=$(this).data("id");Z(a)}),$("#addTransactionForm input, #addTransactionForm select, #addTransactionForm textarea").on("input change",function(){$(this).removeClass("is-invalid");const a=$(this).attr("id")+"_error";$("#"+a).text(""),$("#form_pengeluaran_error").addClass("d-none").text("")})}function ne(){const e=document.getElementById("subkategoriContainer"),a=window.hasSubkategoriPengeluaran;return e&&e.style.display!=="none"&&a}function E(){const e=$("#isSinglePengeluaran").val()==="1",a=JSON.parse($("#pengeluaran_JsonData").val());if(!e&&a.length>0)return console.log("Multiple mode with items in list - skipping form validation"),!0;let t=!0;$(".is-invalid").removeClass("is-invalid"),$(".invalid-feedback").text(""),$("#form_pengeluaran_error").addClass("d-none").text("");const n=[{id:"tanggal_transaksi",name:"Tanggal Transaksi"},{id:"nama_transaksi",name:"Nama Transaksi"},{id:"nominal",name:"Nominal"}];ne()&&(n.push({id:"subkategori_pengeluaran_id",name:"Kategori Pengeluaran"}),console.log("Subkategori validation required")),$.each(n,function(r,l){const o=$("#"+l.id).val();(!o||o.trim()==="")&&($("#"+l.id).addClass("is-invalid"),$("#"+l.id+"_error").text(`${l.name} wajib diisi`),t=!1,console.log(`Validation failed for field: ${l.id}`))});const s=$("#nama_transaksi").val();s&&!L(s)&&($("#nama_transaksi").addClass("is-invalid"),$("#nama_transaksi_error").text("Nama transaksi harus berisi 1-255 karakter"),t=!1);const i=$("#nominal").val();if(i){const r=parseInt(i.replace(/\D/g,""),10);(isNaN(r)||r<=0||r>=10**13)&&($("#nominal").addClass("is-invalid"),$("#nominal_error").text("Nominal harus berupa angka positif dan tidak melebihi batas maksimum"),t=!1)}return $("#bukti_transaksi")[0].files&&$("#bukti_transaksi")[0].files.length>0&&(B()||(t=!1)),t}function ie(){if(!E())return $("#form_pengeluaran_error").removeClass("d-none alert-success").addClass("alert-danger").text("Harap periksa semua field yang wajib diisi."),!1;const e=Date.now().toString(),a=$("#nama_transaksi").val().trim(),t=$("#nominal").val(),n=$("#tanggal_transaksi").val(),s=$("#deskripsi_transaksi").val(),i=$("#subkategori_pengeluaran_id").val()||null,r=Q(t),l=document.getElementById("bukti_transaksi");let o=null,d="";l.files&&l.files.length>0&&(o=l.files[0],d=l.files[0].name,console.log(`File "${d}" associated with item ${e}`));let u=JSON.parse($("#pengeluaran_JsonData").val());const g=u.length,f={id:e,sequence:g,proyek_id:$('input[name="proyek_id"]').val(),jenis_transaksi_id:$("#hidden_jenis_transaksi_id").val(),jenis_keuangan_tefa_id:$("#hidden_jenis_keuangan_tefa_id").val(),subkategori_pengeluaran_id:i,nama_transaksi:a,tanggal_transaksi:n,nominal:t,deskripsi_transaksi:s,has_file:!!o,file:o,fileName:d};u.push(f);const k=u.map(h=>{const{file:p,...m}=h;return m});$("#pengeluaran_JsonData").val(JSON.stringify(k)),window.pengeluaranFiles||(window.pengeluaranFiles={}),o&&(window.pengeluaranFiles[e]=o),$("#isSinglePengeluaran").val("0"),$("#emptyRowPengeluaran").remove();const b=new Date(n).toLocaleDateString("id-ID");let v="";if(d){const h=d.toLowerCase().split(".").pop();let p="",m="";switch(h){case"pdf":p="bi bi-file-earmark-pdf",m="bg-danger";break;case"doc":case"docx":p="bi bi-file-earmark-word",m="bg-primary";break;case"xls":case"xlsx":p="bi bi-file-earmark-excel",m="bg-success";break;case"ppt":case"pptx":p="bi bi-file-earmark-ppt",m="bg-warning";break;case"jpg":case"jpeg":case"png":p="bi bi-file-earmark-image",m="bg-info";break;default:p="bi bi-file-earmark",m="bg-secondary"}v=`
            <div class="d-flex align-items-center">
                <span class="badge ${m} me-1" title="${d}">
                    <i class="${p}"></i>
                </span>
                <small class="text-truncate" style="max-width: 100px;" title="${d}">
                    ${d.length>12?d.substring(0,12)+"...":d}
                </small>
            </div>
        `}else v=`
            <span class="badge bg-light text-dark" title="Tidak ada file">
                <i class="bi bi-file-earmark-x"></i> Tidak Ada
            </span>
        `;const y=`
        <tr id="item-${e}">
            <td>${a}</td>
            <td>${b}</td>
            <td class="text-end">Rp ${r}</td>
            <td>${v}</td>
            <td>
                <button type="button" class="btn btn-sm btn-danger btn-remove-item" data-id="${e}">
                    <i class="bi bi-trash"></i> Hapus
                </button>
            </td>
        </tr>
    `;return $("#daftarPengeluaran").append(y),$(".is-invalid").removeClass("is-invalid"),$(".invalid-feedback").text(""),$("#nama_transaksi").val(""),$("#nominal").val(""),$("#deskripsi_transaksi").val(""),$("#bukti_transaksi").val(""),$("#subkategori_pengeluaran_id").val(""),$("#file_preview_container").empty(),$("#form_pengeluaran_error").removeClass("d-none alert-danger").addClass("alert-success").text("Item berhasil ditambahkan ke daftar."),setTimeout(function(){$("#form_pengeluaran_error").addClass("d-none").removeClass("alert-success")},3e3),!0}function I(){var i;const e=$("#isSinglePengeluaran").val()==="1",a=JSON.parse($("#pengeluaran_JsonData").val());console.log("Submit form with mode:",e?"Single":"Multiple"),console.log("Items in list:",a.length),$("#form_pengeluaran_error").addClass("d-none").text("");const t=$('meta[name="csrf-token"]').attr("content")||$('input[name="_token"]').val()||((i=document.querySelector('meta[name="csrf-token"]'))==null?void 0:i.getAttribute("content"));if(!t)return console.error("CSRF token not found!"),$("#form_pengeluaran_error").removeClass("d-none").addClass("alert-danger").text("CSRF token tidak ditemukan. Silakan refresh halaman."),!1;console.log("Using CSRF token:",t.substring(0,10)+"...");const n=new FormData($("#addTransactionForm")[0]);n.set("_token",t);const s=$("#btnSimpanPengeluaran");if(s.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Menyimpan...'),!e&&a.length>0){if(console.log("Multiple mode - submitting list data, skip form validation"),n.set("pengeluaran_data",JSON.stringify(a)),n.set("is_single","0"),window.pengeluaranFiles){let r=0;for(const[l,o]of Object.entries(window.pengeluaranFiles))o instanceof File&&(n.append(`bukti_transaksi_${l}`,o),r++,console.log(`Added file for item ${l}: ${o.name}`));console.log(`Total ${r} files added to request`)}$.ajax({url:"/koordinator/data-keluar-keuangan-proyek/store-with-files",type:"POST",data:n,processData:!1,contentType:!1,headers:{"X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest"},success:function(r){j()},error:function(r,l,o){F(r,l,o)}})}else if(e){if(console.log("Single mode - validating form before submit"),!E())return $("#form_pengeluaran_error").removeClass("d-none").addClass("alert-danger").text("Harap periksa semua field yang wajib diisi."),s.prop("disabled",!1).html("Simpan"),setTimeout(function(){$(".is-invalid:first").focus()},100),!1;n.set("is_single","1"),$.ajax({url:"/koordinator/data-keluar-keuangan-proyek/tambah-transaksi",type:"POST",data:n,processData:!1,contentType:!1,headers:{"X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest"},success:function(r){j()},error:function(r,l,o){F(r,l,o)}})}else return console.log("Multiple mode but no items in list"),$("#form_pengeluaran_error").removeClass("d-none").addClass("alert-danger").text("Tambahkan minimal satu item ke daftar sebelum menyimpan."),s.prop("disabled",!1).html("Simpan"),!1;return!0}function se(e){console.log("Populating edit form with data:",e);try{$("#keuangan_tefa_id").val(e.keuangan_tefa_id),$("#edit_tanggal_transaksi").val(e.tanggal_transaksi),$("#edit_nama_transaksi").val(e.nama_transaksi),$("#edit_deskripsi_transaksi").val(e.deskripsi_transaksi||""),$("#edit_nominal").val(e.nominal_transaksi),$("#edit_jenis_transaksi_id").val(e.jenis_transaksi_id),$("#edit_jenis_keuangan_tefa_id").val(e.jenis_keuangan_tefa_id),$("#edit_nama_proyek").val(e.nama_proyek);const a=$("#edit_kategoriTransaksiContainer"),t=$("#edit_sub_jenis_transaksi_id"),n=window.hasSubkategoriPengeluaran||t.find('option[value]:not([value=""])').length>0;if(n){a.show(),a.find(".text-danger").length===0&&a.find("label").append(' <span class="text-danger">*</span>');const i=t.find('option[value=""]');i.length&&i.text("Pilih Kategori Pengeluaran"),t.attr("required","required"),e.sub_jenis_transaksi_id?t.val(e.sub_jenis_transaksi_id):t.val(""),window.isEditSubkategoriRequired=!0,console.log("Edit form: Subkategori dropdown shown and REQUIRED (data available)")}else a.hide(),window.isEditSubkategoriRequired=!1,console.log("Edit form: Subkategori dropdown hidden (no data available)");$("#edit_file_preview_container").empty(),e.has_file&&e.file_url&&V(e.file_name,e.file_url),console.log("Edit form populated successfully",{has_subkategori_data:n,subkategori_value:e.sub_jenis_transaksi_id,has_file:e.has_file,subkategori_required:window.isEditSubkategoriRequired})}catch(a){console.error("Error populating edit form:",a),c("Gagal memuat data ke form. Silakan coba lagi.")}}function re(){let e=!0;M();const a=[{id:"edit_tanggal_transaksi",name:"Tanggal Transaksi"},{id:"edit_nama_transaksi",name:"Nama Transaksi"},{id:"edit_nominal",name:"Nominal"}];window.isEditSubkategoriRequired?(a.push({id:"edit_sub_jenis_transaksi_id",name:"Kategori Pengeluaran"}),console.log("Edit validation: Subkategori added to required fields")):console.log("Edit validation: Subkategori not required (no data available)"),$.each(a,function(s,i){const r=$("#"+i.id).val();(!r||r.trim()==="")&&($("#"+i.id).addClass("is-invalid"),$("#"+i.id+"_error").text(`${i.name} wajib diisi`),e=!1,console.log(`Edit validation failed for field: ${i.id}`))});const t=$("#edit_nama_transaksi").val();t&&!L(t)&&($("#edit_nama_transaksi").addClass("is-invalid"),$("#edit_nama_transaksi_error").text("Nama transaksi harus berisi 1-255 karakter"),e=!1);const n=$("#edit_nominal").val();if(n){const s=parseInt(n.replace(/\D/g,""),10);(isNaN(s)||s<=0||s>=10**13)&&($("#edit_nominal").addClass("is-invalid"),$("#edit_nominal_error").text("Nominal harus berupa angka positif dan tidak melebihi batas maksimum"),e=!1)}return $("#edit_file_keuangan_tefa")[0]&&$("#edit_file_keuangan_tefa")[0].files.length>0&&(S()||(e=!1)),console.log("Edit form validation result:",e),e}function oe(){if(console.log("Submitting edit form..."),!re()){$("#form_keuangan_tefa_edit_error").removeClass("d-none").addClass("alert-danger").text("Harap periksa semua field yang wajib diisi."),setTimeout(function(){$(".is-invalid:first").focus()},100);return}const e=$("#keuangan_tefa_id").val();if(!e){c("ID transaksi tidak ditemukan");return}const a=$('meta[name="csrf-token"]').attr("content");if(!a){c("CSRF token tidak ditemukan. Silakan refresh halaman.");return}const t=new FormData($("#formEditDataKeuanganProyek")[0]);t.set("_token",a),t.set("_method","PUT");const n=$("#edit_sub_jenis_transaksi_id").val();if(window.isEditSubkategoriRequired){if(!n){$("#edit_sub_jenis_transaksi_id").addClass("is-invalid"),$("#edit_sub_jenis_transaksi_id_error").text("Kategori Pengeluaran wajib dipilih"),c("Kategori Pengeluaran wajib dipilih karena tersedia dalam sistem.");return}t.set("edit_sub_jenis_transaksi_id",n)}else t.set("edit_sub_jenis_transaksi_id","");console.log("Edit form data being submitted:",{transaksi_id:e,has_subkategori:!!n,subkategori_value:n,subkategori_required:window.isEditSubkategoriRequired,has_new_file:$("#edit_file_keuangan_tefa")[0].files.length>0});const s=$("#btnSimpanEditKeuanganProyek"),i=s.text();s.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Menyimpan...'),$.ajax({url:`/koordinator/data-keluar-keuangan-proyek/update-transaksi/${e}`,type:"POST",data:t,processData:!1,contentType:!1,headers:{"X-CSRF-TOKEN":a,"X-Requested-With":"XMLHttpRequest"},success:function(r){console.log("Edit response:",r),r.success?(w.successMessage("Data transaksi berhasil diperbarui"),$("#modalEditKeuanganProyek").modal("hide"),_()):c(r.message||"Gagal memperbarui data transaksi")},error:function(r,l,o){var d,u,g;if(console.error("Edit error:",{status:r.status,statusText:r.statusText,responseText:r.responseText,error:o}),r.status===422){const f=((d=r.responseJSON)==null?void 0:d.errors)||{};let k=!1;for(const b in f){const v=f[b][0],y=$(`#${b}`),h=$(`#${b}_error`);y.length&&h.length&&(y.addClass("is-invalid"),h.text(v),k=!0)}k||c("Validasi gagal: "+(((u=r.responseJSON)==null?void 0:u.message)||"Silakan periksa data yang diinput."))}else if(r.status===419)c("Token keamanan tidak valid. Silakan refresh halaman dan coba lagi.");else{const f=((g=r.responseJSON)==null?void 0:g.message)||r.statusText||"Terjadi kesalahan yang tidak diketahui.";c(`Error (${r.status}): ${f}`)}},complete:function(){s.prop("disabled",!1).text(i)}})}function le(){const e=document.getElementById("formEditDataKeuanganProyek"),a=document.getElementById("modalEditKeuanganProyek");e&&a&&(a.addEventListener("shown.bs.modal",function(){M()}),$(e).find("input, select, textarea").on("input change",function(){$(this).removeClass("is-invalid");const t=$(this).attr("id")+"_error";$("#"+t).text(""),$("#form_keuangan_tefa_edit_error").addClass("d-none").text("")}),$("#edit_file_keuangan_tefa").change(function(){S(),D()}),e.addEventListener("submit",function(t){t.preventDefault(),oe()}),console.log("Edit transaction form initialized with optional subkategori"))}function M(){$("#formEditDataKeuanganProyek .is-invalid").removeClass("is-invalid"),$("#formEditDataKeuanganProyek .invalid-feedback").text(""),$("#form_keuangan_tefa_edit_error").addClass("d-none").text(""),console.log("Edit form validation errors cleared")}function c(e){$("#form_keuangan_tefa_edit_error").removeClass("d-none").addClass("alert-danger").text(e),$("#editLoadingState").hide(),$("#editFormContent").show()}function de(){$("#filter_pengeluaran_nominal_min, #filter_pengeluaran_nominal_max").on("input",function(){ue($(this))}),$("#formFilterKeuanganTefa").submit(function(e){e.preventDefault(),R()}),$("#btnResetFilter").click(function(){ge()}),$("#filter_tanggal_mulai, #filter_tanggal_akhir").change(function(){q()})}function q(){const e=$("#filter_tanggal_mulai").val(),a=$("#filter_tanggal_akhir").val();if(e&&a){const t=new Date(e);return new Date(a)<t?($("#filter_tanggal_akhir").addClass("is-invalid"),!1):($("#filter_tanggal_akhir").removeClass("is-invalid"),!0)}return $("#filter_tanggal_akhir").removeClass("is-invalid"),!0}function R(){if(console.log("Applying pengeluaran filters..."),!q()){w.errorMessage("Tanggal Akhir tidak boleh lebih awal dari Tanggal Mulai");return}const e={tanggal_mulai:$("#filter_tanggal_mulai").val(),tanggal_akhir:$("#filter_tanggal_akhir").val(),nama_transaksi:$("#filter_nama_transaksi").val(),kategori_pengeluaran:$("#filter_jenis_keuangan").val(),status_bukti:$("#filter_sub_jenis_transaksi").val()};console.log("Applied filters:",e),me(),_(1,e)}function K(){for(let e=localStorage.length-1;e>=0;e--){const a=localStorage.key(e);a&&(a.startsWith("filter_")||a==="pengeluaranFiltersApplied")&&localStorage.removeItem(a)}}function ue(e){let a=e.val().replace(/\D/g,"");if(a===""){e.val("");return}a=a.replace(/^0+/,"")||"0",a=a.replace(/\B(?=(\d{3})+(?!\d))/g,"."),e.val(a)}function _(e=1,a={}){var l;const t=document.querySelector("#tableKeuangan tbody");if(!t){console.error("Table body element not found");return}const n=document.querySelector('input[name="proyek_id"]');if(!n){console.error("Could not find proyek_id input field");return}z();const s=n.value;console.log("Loading transaction data for proyek ID:",s,"Page:",e,"Filters:",a),t.innerHTML=`
        <tr>
            <td colspan="5" class="text-center">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2 text-muted small">Memuat data...</p>
            </td>
        </tr>
    `;const i=(l=document.querySelector('meta[name="csrf-token"]'))==null?void 0:l.getAttribute("content");i||console.error("CSRF token not found");const r=new URLSearchParams({page:e,per_page:5,...a});fetch(`/koordinator/data-keluar-keuangan-proyek/${s}/transaksi?${r.toString()}`,{method:"GET",headers:{"X-CSRF-TOKEN":i||"",Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(o=>{if(!o.ok)throw new Error("Network response was not ok: "+o.status);return o.json()}).then(o=>{if(console.log("Transaction data loaded:",o),o.data&&o.data.length>0){let d="";o.data.forEach(u=>{d+=`
                <tr>
                    <td>${u.tanggal}</td>
                    <td>${u.keterangan}</td>
                    <td>Rp ${u.nominal}</td>
                    <td>${u.bukti}</td>
                    <td>
                        <div class="d-flex gap-1">
                            <button type="button" class="btn btn-action-detail-keuangan" data-id="${u.id}" data-bs-toggle="modal" data-bs-target="#modalEditKeuanganProyek">
                                <svg width="18" height="18" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M13.586 3.586C14.367 2.805 15.633 2.805 16.414 3.586L16.414 3.586C17.195 4.367 17.195 5.633 16.414 6.414L15.621 7.207L12.793 4.379L13.586 3.586Z" fill="#3C21F7"/>
                                    <path d="M11.379 5.793L3 14.172V17H5.828L14.207 8.621L11.379 5.793Z" fill="#3C21F7"/>
                                </svg>
                            </button>
                            <button type="button" class="btn btn-action-delete" data-id="${u.id}" title="Hapus">
                                <svg width="20" height="20" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M21.5896 12.4848C21.5896 17.6563 17.459 21.8486 12.3636 21.8486C7.26829 21.8486 3.1377 17.6563 3.1377 12.4848C3.1377 7.31339 7.26829 3.12109 12.3636 3.12109C17.459 3.12109 21.5896 7.31339 21.5896 12.4848ZM7.56137 17.3588C7.17375 16.9654 7.17375 16.3276 7.56137 15.9342L10.9599 12.4848L7.56137 9.03551C7.17375 8.6421 7.17375 8.00426 7.56137 7.61085C7.94899 7.21744 8.57744 7.21744 8.96506 7.61085L12.3636 11.0602L15.7622 7.61085C16.1498 7.21744 16.7783 7.21744 17.1659 7.61085C17.5535 8.00426 17.5535 8.6421 17.1659 9.03551L13.7673 12.4848L17.1659 15.9342C17.5535 16.3276 17.5535 16.9654 17.1659 17.3588C16.7783 17.7522 16.1498 17.7522 15.7622 17.3588L12.3636 13.9095L8.96506 17.3588C8.57744 17.7522 7.94899 17.7522 7.56137 17.3588Z" fill="#E56F8C"/>
                                </svg>
                            </button>
                        </div>
                    </td>
                </tr>
                `}),t.innerHTML=d,Y(),H(),T(o),P(o.pagination,a)}else{const u=Object.keys(a).some(g=>a[g]!==""&&a[g]!==void 0)?"Tidak ada data transaksi yang sesuai dengan filter yang dipilih.":"Belum ada data transaksi pengeluaran";t.innerHTML=`
                <tr>
                    <td colspan="5" class="text-center py-4">
                        <div class="d-flex justify-content-center flex-column align-items-center">
                            <svg width="60" height="60" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="mb-3">
                                <path d="M8 2V5" stroke="#8E8E8E" stroke-width="1.5" stroke-linecap="round"/>
                                <path d="M16 2V5" stroke="#8E8E8E" stroke-width="1.5" stroke-linecap="round"/>
                                <path d="M3.5 9.08984H20.5" stroke="#8E8E8E" stroke-width="1.5" stroke-linecap="round"/>
                                <path d="M19.21 15.7698L15.67 19.3098C15.53 19.4498 15.4 19.7098 15.37 19.8998L15.18 21.2498C15.11 21.7398 15.45 22.0798 15.94 22.0098L17.29 21.8198C17.48 21.7898 17.75 21.6598 17.88 21.5198L21.42 17.9798C22.03 17.3698 22.32 16.6598 21.42 15.7598C20.53 14.8698 19.82 15.1598 19.21 15.7698Z" stroke="#8E8E8E" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M18.7002 16.2798C19.0002 17.3598 19.8402 18.1998 20.9202 18.4998" stroke="#8E8E8E" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M12 22H8C4.5 22 3 20 3 17V8.5C3 5.5 4.5 3.5 8 3.5H16C19.5 3.5 21 5.5 21 8.5V12" stroke="#8E8E8E" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M11.9955 13.7002H12.0045" stroke="#8E8E8E" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M8.29431 13.7002H8.30329" stroke="#8E8E8E" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M8.29431 16.7002H8.30329" stroke="#8E8E8E" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <p class="text-muted">${u}</p>
                        </div>
                    </td>
                </tr>
            `,T({from:0,to:0,total:0}),P(null)}}).catch(o=>{console.error("Error loading transaction data:",o),t.innerHTML=`
        <tr>
            <td colspan="5" class="text-center text-danger py-4">
                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="mb-3">
                    <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="#FF5757" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M15 9L9 15" stroke="#FF5757" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M9 9L15 15" stroke="#FF5757" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <p>Gagal memuat data transaksi</p>
                <p class="small text-muted">Silakan coba lagi nanti</p>
            </td>
        </tr>
        `})}function P(e,a={}){const t=document.getElementById("keuanganTefaPagination");if(!t)return;if(!e||e.total===0){t.innerHTML="";return}let n='<nav aria-label="Table pagination"><ul class="pagination pagination-sm mb-0">';e.current_page>1?n+=`
            <li class="page-item">
                <button class="page-link pagination-btn" data-page="${e.current_page-1}" data-filters='${JSON.stringify(a)}' aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                </button>
            </li>
        `:n+=`
            <li class="page-item disabled">
                <span class="page-link" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                </span>
            </li>
        `;const s=Math.max(1,e.current_page-2),i=Math.min(e.last_page,e.current_page+2);s>1&&(n+=`<li class="page-item"><button class="page-link pagination-btn" data-page="1" data-filters='${JSON.stringify(a)}'>1</button></li>`,s>2&&(n+='<li class="page-item disabled"><span class="page-link">...</span></li>'));for(let r=s;r<=i;r++)r===e.current_page?n+=`<li class="page-item active"><span class="page-link">${r}</span></li>`:n+=`<li class="page-item"><button class="page-link pagination-btn" data-page="${r}" data-filters='${JSON.stringify(a)}'>${r}</button></li>`;i<e.last_page&&(i<e.last_page-1&&(n+='<li class="page-item disabled"><span class="page-link">...</span></li>'),n+=`<li class="page-item"><button class="page-link pagination-btn" data-page="${e.last_page}" data-filters='${JSON.stringify(a)}'>${e.last_page}</button></li>`),e.current_page<e.last_page?n+=`
            <li class="page-item">
                <button class="page-link pagination-btn" data-page="${e.current_page+1}" data-filters='${JSON.stringify(a)}' aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                </button>
            </li>
        `:n+=`
            <li class="page-item disabled">
                <span class="page-link" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                </span>
            </li>
        `,n+="</ul></nav>",t.innerHTML=n,ce()}function ce(){document.querySelectorAll(".pagination-btn").forEach(a=>{a.addEventListener("click",function(t){t.preventDefault();const n=parseInt(this.dataset.page),s=JSON.parse(this.dataset.filters||"{}");n&&!isNaN(n)&&(console.log("Loading page with filters:",n,s),_(n,s))})})}function O(){if(console.log("Initializing Select2 for filters..."),!$.fn.select2){console.warn("Select2 library not loaded. Searchable dropdowns will not be available.");return}try{$("#filter_jenis_keuangan").length&&($("#filter_jenis_keuangan").hasClass("select2-hidden-accessible")&&$("#filter_jenis_keuangan").select2("destroy"),$("#filter_jenis_keuangan").select2({theme:"bootstrap-5",width:"100%",placeholder:"Pilih Kategori Pengeluaran",allowClear:!0,language:{noResults:function(){return"Tidak ada kategori yang ditemukan"},searching:function(){return"Mencari..."}}})),$("#filter_sub_jenis_transaksi").length&&($("#filter_sub_jenis_transaksi").hasClass("select2-hidden-accessible")&&$("#filter_sub_jenis_transaksi").select2("destroy"),$("#filter_sub_jenis_transaksi").select2({theme:"bootstrap-5",width:"100%",placeholder:"Pilih Status Bukti",allowClear:!0,language:{noResults:function(){return"Tidak ada status yang ditemukan"},searching:function(){return"Mencari..."}}})),console.log("Select2 filters initialized successfully")}catch(e){console.warn("Error initializing Select2 for filters:",e)}}function C(){const e=document.querySelector('input[name="proyek_id"]');if(!e){console.error("Proyek ID input not found");return}const a=e.value,t="/koordinator/data-keluar-keuangan-proyek/get-kategori-pengeluaran";console.log("Calling URL:",t,"with proyek_id:",a),$.ajax({url:t,type:"GET",data:{proyek_id:a},dataType:"json",beforeSend:function(){$("#filter_jenis_keuangan").hasClass("select2-hidden-accessible")&&$("#filter_jenis_keuangan").select2("destroy"),$("#filter_jenis_keuangan").html('<option value="">Loading...</option>')},success:function(n){if(n.success&&n.results&&n.results.length>0){let s='<option value="">Semua Kategori</option>';$.each(n.results,function(r,l){s+=`<option value="${l.id}">${l.text}</option>`}),$("#filter_jenis_keuangan").html(s),$("#filterKategoriTransaksiContainer").show();try{$("#filter_jenis_keuangan").select2({theme:"bootstrap-5",width:"100%",placeholder:"Pilih Kategori Pengeluaran",allowClear:!0,language:{noResults:function(){return"Tidak ada kategori yang ditemukan"},searching:function(){return"Mencari..."}}})}catch(r){console.warn("Error initializing Select2 for kategori filter:",r)}const i=localStorage.getItem("filter_jenis_keuangan");i&&$("#filter_jenis_keuangan").val(i).trigger("change"),console.log("Kategori loaded and Select2 initialized with Bootstrap 5 theme")}else $("#filterKategoriTransaksiContainer").hide(),$("#filter_jenis_keuangan").html('<option value="">Semua Kategori</option>'),console.log("No kategori data available")},error:function(n,s,i){console.error("Failed to load kategori pengeluaran:",{status:n.status,statusText:n.statusText,responseText:n.responseText,error:i}),$("#filterKategoriTransaksiContainer").hide(),$("#filter_jenis_keuangan").html('<option value="">Error loading data</option>')}})}function ge(){console.log("Resetting pengeluaran filters..."),$("#formFilterKeuanganTefa select").each(function(){$(this).hasClass("select2-hidden-accessible")&&$(this).select2("destroy")}),$("#formFilterKeuanganTefa")[0].reset(),$("#formFilterKeuanganTefa .is-invalid").removeClass("is-invalid"),K();const e=document.querySelector('input[name="proyek_id"]');e&&e.value?(console.log("Reloading kategori pengeluaran after reset..."),C()):(console.warn("No proyek_id found, hiding kategori container"),$("#filterKategoriTransaksiContainer").hide(),$("#filter_jenis_keuangan").html('<option value="">Semua Kategori</option>')),setTimeout(function(){O()},100),_(1,{}),console.log("Pengeluaran filters reset completed")}function fe(){console.log("Initializing pengeluaran filters..."),C(),O(),de(),pe(),console.log("Pengeluaran filters initialized successfully")}function me(){$("#formFilterKeuanganTefa").find("input, select").each(function(){if($(this).attr("id")){let e=$(this).val();$(this).data("select2")&&(e=$(this).select2("val")),localStorage.setItem($(this).attr("id"),e||"")}}),localStorage.setItem("pengeluaranFiltersApplied",new Date().getTime())}function pe(){const e=localStorage.getItem("pengeluaranFiltersApplied");if(!e)return;const a=new Date().getTime()-60*60*1e3;if(parseInt(e)<a){K();return}$("#formFilterKeuanganTefa").find("input, select").each(function(){const t=$(this).attr("id");if(t){const n=localStorage.getItem(t);n!==null&&n!==""&&($(this).val(n),$(this).data("select2")&&$(this).trigger("change"))}}),C(),($("#filter_tanggal_mulai").val()||$("#filter_tanggal_akhir").val()||$("#filter_nama_transaksi").val()||$("#filter_jenis_keuangan").val()||$("#filter_sub_jenis_transaksi").val())&&setTimeout(function(){R()},500)}function z(){$("#totalPengeluaran").text("Loading..."),console.log("Updating financial summary...");const e=document.querySelector('input[name="proyek_id"]');if(!e){console.error("Proyek ID input not found"),$("#totalPengeluaran").text("Error");return}const a=e.value;console.log("Getting summary for proyek ID:",a),$.ajax({url:`/koordinator/data-keluar-keuangan-proyek/${a}/summary`,type:"GET",dataType:"json",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content"),"X-Requested-With":"XMLHttpRequest"},success:function(t){if(console.log("Financial summary response:",t),t.success&&t.data){const n=t.data,s=i=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(i||0);$("#totalPengeluaran").text(s(n.total_pengeluaran)),$("#jumlahTransaksiPengeluaran").length&&$("#jumlahTransaksiPengeluaran").text(n.transaksi_count||0),$("#kategoriBreakdown").length&&n.pengeluaran_by_kategori&&updateKategoriBreakdown(n.pengeluaran_by_kategori),console.log("Financial summary updated successfully")}else throw new Error(t.message||"Invalid response format")},error:function(t,n,s){console.error("Error getting financial summary:",{status:t.status,statusText:t.statusText,responseText:t.responseText,error:s}),$("#totalPengeluaran").text("Error"),$("#summaryError").length&&$("#summaryError").removeClass("d-none").text("Gagal memuat ringkasan keuangan")}})}
