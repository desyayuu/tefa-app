import{s as w}from"./components-C-5l6dZl.js";$(document).ready(function(){let f=1,p=3,r={};_(1),window.location.hash==="#data-timeline-section"&&setTimeout(function(){D()},300),$(document).on("click",".pagination-link",function(e){e.preventDefault(),f=$(this).data("page"),_(f),$("html, body").animate({scrollTop:$("#tableDataTimeline").offset().top-100},500)}),$("#searchTimelineForm").on("submit",function(e){e.preventDefault();const t=$("#searchTimeline").val(),i=new URL(window.location.href);i.searchParams.set("search",t),i.hash="data-timeline-section",window.history.pushState({},"",i.toString()),f=1,_(),D()}),$("#btnClearSearch").on("click",function(){$("#searchTimeline").val("");const e=new URL(window.location.href);e.searchParams.delete("search"),window.history.pushState({},"",e.toString()),_(),$("#btnClearSearch").addClass("d-none")});function k(e,t){if(!r.tanggal_mulai||!r.tanggal_selesai)return{valid:!0};const i=new Date(r.tanggal_mulai),a=new Date(r.tanggal_selesai),n=new Date(e),m=new Date(t);return n<i?{valid:!1,field:"tanggal_mulai_timeline",message:`Tanggal mulai timeline tidak boleh sebelum tanggal mulai proyek (${u(r.tanggal_mulai)})`}:m>a?{valid:!1,field:"tanggal_selesai_timeline",message:`Tanggal selesai timeline tidak boleh setelah tanggal selesai proyek (${u(r.tanggal_selesai)})`}:n>a?{valid:!1,field:"tanggal_mulai_timeline",message:`Tanggal mulai timeline tidak boleh setelah tanggal selesai proyek (${u(r.tanggal_selesai)})`}:m<i?{valid:!1,field:"tanggal_selesai_timeline",message:`Tanggal selesai timeline tidak boleh sebelum tanggal mulai proyek (${u(r.tanggal_mulai)})`}:{valid:!0}}function v(){r.tanggal_mulai&&r.tanggal_selesai&&($("#tanggal_mulai_timeline").attr("min",r.tanggal_mulai),$("#tanggal_mulai_timeline").attr("max",r.tanggal_selesai),$("#tanggal_selesai_timeline").attr("min",r.tanggal_mulai),$("#tanggal_selesai_timeline").attr("max",r.tanggal_selesai),$("#edit_tanggal_mulai_timeline").attr("min",r.tanggal_mulai),$("#edit_tanggal_mulai_timeline").attr("max",r.tanggal_selesai),$("#edit_tanggal_selesai_timeline").attr("min",r.tanggal_mulai),$("#edit_tanggal_selesai_timeline").attr("max",r.tanggal_selesai))}$("#tanggal_mulai_timeline, #edit_tanggal_mulai_timeline").on("change",function(){const e=$(this).val(),i=$(this).attr("id").includes("edit")?"#edit_tanggal_selesai_timeline":"#tanggal_selesai_timeline";e&&$(i).attr("min",e)}),$("#formEditTimeline").on("submit",function(e){e.preventDefault(),$("#edit_form_error").addClass("d-none").text(""),$(".is-invalid").removeClass("is-invalid"),$(".invalid-feedback").text("");const t=$("#edit_timeline_id").val(),i=new FormData(this),a=$("#edit_nama_timeline").val(),n=$("#edit_tanggal_mulai_timeline").val(),m=$("#edit_tanggal_selesai_timeline").val();let s=!1;if(a||($("#edit_nama_timeline_error").text("Nama timeline harus diisi"),$("#edit_nama_timeline").addClass("is-invalid"),s=!0),n||($("#edit_tanggal_mulai_timeline_error").text("Tanggal mulai harus diisi"),$("#edit_tanggal_mulai_timeline").addClass("is-invalid"),s=!0),m||($("#edit_tanggal_selesai_timeline_error").text("Tanggal selesai harus diisi"),$("#edit_tanggal_selesai_timeline").addClass("is-invalid"),s=!0),n&&m&&new Date(n)>new Date(m)&&($("#edit_tanggal_selesai_timeline_error").text("Tanggal selesai harus setelah tanggal mulai"),$("#edit_tanggal_selesai_timeline").addClass("is-invalid"),s=!0),n&&m){const l=k(n,m);l.valid||($(`#edit_${l.field}_error`).text(l.message),$(`#edit_${l.field}`).addClass("is-invalid"),s=!0)}if(s)return!1;const o=$("#btnUpdateTimeline"),d=o.text();o.prop("disabled",!0).html(`
            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
            <span>Menyimpan...</span>
        `),$.ajax({url:`/mahasiswa/proyek/timeline/${t}`,type:"POST",data:i,processData:!1,contentType:!1,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(l){l.success?w.successMessage(l.message).then(()=>{_(),$("#modalEditTimeline").modal("hide")}):$("#edit_form_error").removeClass("d-none").text(l.message)},error:function(l){if(console.error("Error updating timeline:",l.responseText),l.status===422)try{const c=JSON.parse(l.responseText);c.errors?$.each(c.errors,function(h,E){const S=h==="nama_timeline"?"edit_nama_timeline":h==="tanggal_mulai_timeline"?"edit_tanggal_mulai_timeline":h==="tanggal_selesai_timeline"?"edit_tanggal_selesai_timeline":h==="deskripsi_timeline"?"edit_deskripsi":h,O=Array.isArray(E)?E[0]:E;$(`#${S}_error`).text(O),$(`#${S}`).addClass("is-invalid")}):$("#edit_form_error").removeClass("d-none").text(c.message||"Terjadi kesalahan. Silakan coba lagi.")}catch{$("#edit_form_error").removeClass("d-none").text("Terjadi kesalahan. Silakan coba lagi.")}else $("#edit_form_error").removeClass("d-none").text("Terjadi kesalahan. Silakan coba lagi.")},complete:function(){o.prop("disabled",!1).html(d)}})});function T(e,t,i){const a=i>0?(e-1)*t+1:0,n=Math.min(e*t,i);$("#timelinePaginationInfo").html(`Showing ${a} to ${n} of ${i} entries`)}function D(){const e=$("#data-timeline-section");e.length&&$("html, body").animate({scrollTop:e.offset().top-80},500)}function _(e=1){const t=$('input[name="proyek_id"]').val(),i=$("#searchTimeline").val()||"";$("#tableDataTimeline tbody").empty(),$("#tableDataTimeline tbody").html(`
            <tr>
                <td colspan="4" class="text-center py-4">
                    <div class="d-flex justify-content-center">
                        <div class="spinner-border spinner-border-sm text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                    <p class="mt-2 text-muted small">Memuat data...</p>
                </td>
            </tr>
        `),$("#emptyDataTimelineMessage").addClass("d-none"),$("#timelinePagination").html(""),$.ajax({url:`/mahasiswa/proyek/${t}/timeline`,type:"GET",data:{search:i,page:e,per_page_timeline:p},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(a){if($("#tableDataTimeline tbody").empty(),typeof a=="string"&&a.indexOf("<!DOCTYPE html>")>=0){console.error("Received HTML response instead of JSON"),b(i);return}a.success&&a.data?(typeof a.isMember<"u"&&(window.isMember=a.isMember),a.proyek_dates&&(r=a.proyek_dates,v()),Array.isArray(a.data)&&a.data.length>0?(a.pagination&&(T(a.pagination.current_page,a.pagination.per_page_timeline,a.pagination.total),a.pagination.html&&$("#timelinePagination").html(a.pagination.html)),F(a.data)):(b(i),T(1,p,0))):(b(i),T(1,p,0))},error:function(a){console.error("Error loading timeline:",a.responseText),$("#tableDataTimeline tbody").html(`
                    <tr>
                        <td colspan="4" class="text-center text-danger py-4">
                            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="mb-3">
                                <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="#FF5757" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M15 9L9 15" stroke="#FF5757" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M9 9L15 15" stroke="#FF5757" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <p>Terjadi kesalahan saat memuat data</p>
                            <p class="small text-muted">Silakan coba lagi nanti</p>
                        </td>
                    </tr>
                `),$("#timelinePagination").html(""),T(1,p,0)}})}function j(e){$("#formEditTimeline")[0].reset(),$("#edit_form_error").addClass("d-none").text(""),$(".is-invalid").removeClass("is-invalid"),$(".invalid-feedback").text(""),$("#edit_timeline_id").val(e);const t=$("#modalEditTimeline .modal-body"),i=t.html();t.html(`
            <div class="d-flex justify-content-center align-items-center py-5">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="ms-3 mb-0">Memuat data...</p>
            </div>
        `),$.ajax({url:`/mahasiswa/proyek/timeline/${e}`,type:"GET",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(a){if(a.success&&a.data){t.html(i),a.proyek_dates&&(r=a.proyek_dates,v());const n=a.data;$("#edit_nama_timeline").val(n.nama_timeline_proyek),$("#edit_tanggal_mulai_timeline").val(M(n.tanggal_mulai_timeline)),$("#edit_tanggal_selesai_timeline").val(M(n.tanggal_selesai_timeline)),$("#edit_deskripsi").val(n.deskripsi_timeline)}else w.errorMessage("Gagal memuat data timeline"),$("#modalEditTimeline").modal("hide")},error:function(a){console.error("Error loading timeline detail:",a.responseText),w.errorMessage("Terjadi kesalahan saat memuat data timeline"),$("#modalEditTimeline").modal("hide")}})}function F(e){const t=$("#tableDataTimeline tbody");if(t.empty(),!e||!Array.isArray(e)||e.length===0){const a=$("#searchTimeline").val()||"";b(a);return}$("#emptyDataTimelineMessage").addClass("d-none");let i="";e.forEach((a,n)=>{const m=a.timeline_proyek_id;if(!m){console.warn("Missing timeline ID for item at index",n,a);return}const s=a.nama_timeline_proyek||"Unnamed",o=u(a.tanggal_mulai_timeline),d=u(a.tanggal_selesai_timeline);let l="";window.isMember&&(l=`                    
                    <button type="button" class="btn btn-action-detail-timeline" data-id="${m}" data-bs-toggle="modal" data-bs-target="#modalEditTimeline">
                        <svg width="15" height="15" viewBox="0 0 26 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M21.0571 10.9056C21.4729 11.3872 21.6808 11.628 21.6808 12C21.6808 12.372 21.4729 12.6128 21.0571 13.0944C19.5628 14.8252 16.307 18 12.5313 18C8.7555 18 5.49977 14.8252 4.00541 13.0944C3.58961 12.6128 3.38171 12.372 3.38171 12C3.38171 11.628 3.58961 11.3872 4.00541 10.9056C5.49977 9.17485 8.7555 6 12.5313 6C16.307 6 19.5628 9.17485 21.0571 10.9056Z" fill="#3C21F7"/>
                            <path d="M15.6641 12C15.6641 13.6569 14.2615 15 12.5313 15C10.801 15 9.39844 13.6569 9.39844 12C9.39844 10.3431 10.801 9 12.5313 9C14.2615 9 15.6641 10.3431 15.6641 12Z" fill="white"/>
                        </svg>
                    </button>`),i+=`
                <tr data-id="${m}">
                    <td>${s}</td>
                    <td>${o}</td>
                    <td>${d}</td>
                    <td>
                        <div class="d-flex gap-2">
                            ${l}
                        </div>
                    </td>
                </tr>
            `}),t.html(i),N()}function M(e){if(!e)return"";const t=new Date(e);if(isNaN(t.getTime()))return"";const i=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0");return`${i}-${a}-${n}`}function u(e){if(!e)return"-";const t=new Date(e);if(isNaN(t.getTime()))return e;const i=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"];return`${t.getDate()} ${i[t.getMonth()]} ${t.getFullYear()}`}function b(e){$("#tableDataTimeline tbody").empty(),$("#emptyDataTimelineMessage").removeClass("d-none"),e?$("#emptyDataTimelineMessage div").html(`
                <svg width="60" height="60" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="mb-3">
                    <circle cx="11" cy="11" r="8" stroke="#8E8E8E" stroke-width="1.5"/>
                    <path d="M16.5 16.5L21 21" stroke="#8E8E8E" stroke-width="1.5" stroke-linecap="round"/>
                    <path d="M11 7V11" stroke="#8E8E8E" stroke-width="1.5" stroke-linecap="round"/>
                    <path d="M11 15H11.01" stroke="#8E8E8E" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
                <p class="text-muted mb-1">Tidak ada timeline ditemukan dengan kata kunci: <strong>"${e}"</strong></p>
            `):$("#emptyDataTimelineMessage div").html(`
                <svg width="60" height="60" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="mb-3">
                    <path d="M8 2V5" stroke="#8E8E8E" stroke-width="1.5" stroke-linecap="round"/>
                    <path d="M16 2V5" stroke="#8E8E8E" stroke-width="1.5" stroke-linecap="round"/>
                    <path d="M3.5 9.08984H20.5" stroke="#8E8E8E" stroke-width="1.5" stroke-linecap="round"/>
                    <path d="M19.21 15.7698L15.67 19.3098C15.53 19.4498 15.4 19.7098 15.37 19.8998L15.18 21.2498C15.11 21.7398 15.45 22.0798 15.94 22.0098L17.29 21.8198C17.48 21.7898 17.75 21.6598 17.88 21.5198L21.42 17.9798C22.03 17.3698 22.32 16.6598 21.42 15.7598C20.53 14.8698 19.82 15.1598 19.21 15.7698Z" stroke="#8E8E8E" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M18.7002 16.2798C19.0002 17.3598 19.8402 18.1998 20.9202 18.4998" stroke="#8E8E8E" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M12 22H8C4.5 22 3 20 3 17V8.5C3 5.5 4.5 3.5 8 3.5H16C19.5 3.5 21 5.5 21 8.5V12" stroke="#8E8E8E" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M11.9955 13.7002H12.0045" stroke="#8E8E8E" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M8.29431 13.7002H8.30329" stroke="#8E8E8E" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M8.29431 16.7002H8.30329" stroke="#8E8E8E" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <p class="text-muted">Belum ada timeline</p>
            `)}let g=[];$("#btnTambahkanKeDaftarTimeline").on("click",function(){x();const e=$("#nama_timeline").val(),t=$("#tanggal_mulai_timeline").val(),i=$("#tanggal_selesai_timeline").val(),a=$("#deskripsi_timeline").val()||"";let n=!1;if(e||($("#nama_timeline").addClass("is-invalid"),$("#nama_timeline_error").text("Nama timeline harus diisi"),n=!0),t||($("#tanggal_mulai_timeline").addClass("is-invalid"),$("#tanggal_mulai_timeline_error").text("Tanggal mulai harus diisi"),n=!0),i||($("#tanggal_selesai_timeline").addClass("is-invalid"),$("#tanggal_selesai_timeline_error").text("Tanggal selesai harus diisi"),n=!0),t&&i&&new Date(t)>new Date(i)&&($("#tanggal_selesai_timeline").addClass("is-invalid"),$("#tanggal_selesai_timeline_error").text("Tanggal selesai harus setelah tanggal mulai"),n=!0),t&&i){const s=k(t,i);s.valid||($(`#${s.field}_error`).text(s.message),$(`#${s.field}`).addClass("is-invalid"),n=!0)}if(n)return;const m={id:Date.now(),nama_timeline:e,tanggal_mulai_timeline:t,tanggal_selesai_timeline:i,deskripsi_timeline:a};g.push(m),$("#timelineJsonData").val(JSON.stringify(g)),$("#isSingleTimeline").val("0"),y(),C()});function C(){$("#nama_timeline").val(""),$("#tanggal_mulai_timeline").val(""),$("#tanggal_selesai_timeline").val(""),$("#deskripsi_timeline").val(""),x()}function x(){$(".is-invalid").removeClass("is-invalid"),$(".invalid-feedback").text(""),$("#form_timeline_error").addClass("d-none").text("")}function y(){const e=$("#daftarTimeline");if(g.length===0){e.html(`
                <tr id="emptyRowTimeline">
                    <td colspan="4" class="text-center">Belum ada timeline yang ditambahkan ke daftar</td>
                </tr>
            `);return}$("#emptyRowTimeline").remove(),e.empty(),g.forEach((t,i)=>{const a=u(t.tanggal_mulai_timeline),n=u(t.tanggal_selesai_timeline);e.append(`
                <tr>
                    <td>${t.nama_timeline}</td>
                    <td>${a}</td>
                    <td>${n}</td>
                    <td>
                        <button type="button" class="btn btn-action-delete btn-remove-timeline" data-id="${t.id}">
                            <svg width="20" height="20" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M21.5896 12.4848C21.5896 17.6563 17.459 21.8486 12.3636 21.8486C7.26829 21.8486 3.1377 17.6563 3.1377 12.4848C3.1377 7.31339 7.26829 3.12109 12.3636 3.12109C17.459 3.12109 21.5896 7.31339 21.5896 12.4848ZM7.56137 17.3588C7.17375 16.9654 7.17375 16.3276 7.56137 15.9342L10.9599 12.4848L7.56137 9.03551C7.17375 8.6421 7.17375 8.00426 7.56137 7.61085C7.94899 7.21744 8.57744 7.21744 8.96506 7.61085L12.3636 11.0602L15.7622 7.61085C16.1498 7.21744 16.7783 7.21744 17.1659 7.61085C17.5535 8.00426 17.5535 8.6421 17.1659 9.03551L13.7673 12.4848L17.1659 15.9342C17.5535 16.3276 17.5535 16.9654 17.1659 17.3588C16.7783 17.7522 16.1498 17.7522 15.7622 17.3588L12.3636 13.9095L8.96506 17.3588C8.57744 17.7522 7.94899 17.7522 7.56137 17.3588Z" fill="#E56F8C"/>
                            </svg>
                        </button>
                    </td>
                </tr>
            `)}),$(".btn-remove-timeline").off("click").on("click",function(){const t=$(this).data("id");L(t)})}function L(e){g=g.filter(t=>t.id!==e),$("#timelineJsonData").val(JSON.stringify(g)),g.length===0&&$("#isSingleTimeline").val("1"),y()}$("#modalTambahTimeline").on("hidden.bs.modal",function(){C(),g=[],$("#timelineJsonData").val("[]"),$("#isSingleTimeline").val("1"),y()}),$("#formTambahDataTimeline").on("submit",function(e){if(e.preventDefault(),$(this).data("submitting"))return!1;$(this).data("submitting",!0),x();const t=$("#isSingleTimeline").val()==="1",i=new FormData(this);if(t){const s=$("#nama_timeline").val(),o=$("#tanggal_mulai_timeline").val(),d=$("#tanggal_selesai_timeline").val();let l=!1;if(s||($("#nama_timeline_error").text("Nama timeline harus diisi"),$("#nama_timeline").addClass("is-invalid"),l=!0),o||($("#tanggal_mulai_timeline_error").text("Tanggal mulai harus diisi"),$("#tanggal_mulai_timeline").addClass("is-invalid"),l=!0),d||($("#tanggal_selesai_timeline_error").text("Tanggal selesai harus diisi"),$("#tanggal_selesai_timeline").addClass("is-invalid"),l=!0),o&&d&&new Date(o)>new Date(d)&&($("#tanggal_selesai_timeline_error").text("Tanggal selesai harus setelah tanggal mulai"),$("#tanggal_selesai_timeline").addClass("is-invalid"),l=!0),o&&d){const c=k(o,d);c.valid||($(`#${c.field}_error`).text(c.message),$(`#${c.field}`).addClass("is-invalid"),l=!0)}if(l)return $(this).data("submitting",!1),!1}else{if(g.length===0)return $("#form_timeline_error").removeClass("d-none").text("Anda belum menambahkan timeline ke daftar"),$(this).data("submitting",!1),!1;let s=[];if(g.forEach((o,d)=>{const l=k(o.tanggal_mulai_timeline,o.tanggal_selesai_timeline);l.valid||s.push(`Timeline ke-${d+1}: ${l.message}`)}),s.length>0)return $("#form_timeline_error").removeClass("d-none").html(s.join("<br>")),$(this).data("submitting",!1),!1}const a=$("#btnSimpanTimeline"),n=a.text();a.prop("disabled",!0).html(`
            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
            <span>Menyimpan...</span>
        `);const m=this;$.ajax({url:"/mahasiswa/proyek/timeline/",type:"POST",data:i,processData:!1,contentType:!1,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(s){s.success?w.successMessage(s.message).then(()=>{C(),g=[],$("#timelineJsonData").val("[]"),$("#isSingleTimeline").val("1"),y(),$("#modalTambahTimeline").modal("hide"),$(m).data("submitting",!1),setTimeout(function(){f=1,_(f)},300)}):($("#form_timeline_error").removeClass("d-none").text(s.message||"Terjadi kesalahan"),$(m).data("submitting",!1))},error:function(s){if(console.error("Error adding timeline:",s.responseText),s.status===422)try{const o=JSON.parse(s.responseText);o.errors?$.each(o.errors,function(d,l){const c=Array.isArray(l)?l[0]:l;$(`#${d}_error`).text(c),$(`#${d}`).addClass("is-invalid")}):$("#form_timeline_error").removeClass("d-none").text(o.message||"Terjadi kesalahan. Silakan coba lagi.")}catch{$("#form_timeline_error").removeClass("d-none").text("Terjadi kesalahan. Silakan coba lagi.")}else $("#form_timeline_error").removeClass("d-none").text("Terjadi kesalahan. Silakan coba lagi.");$(m).data("submitting",!1)},complete:function(){a.prop("disabled",!1).html(n)}})});function N(){$(".btn-action-detail-timeline").off("click").on("click",function(){const e=$(this).data("id");j(e)})}$("#modalTambahTimeline").on("shown.bs.modal",function(){if(!r.tanggal_mulai||!r.tanggal_selesai){const e=$('input[name="proyek_id"]').val();e&&$.ajax({url:`/mahasiswa/proyek/${e}/timeline`,type:"GET",data:{page:1,per_page_timeline:1},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(t){t.success&&t.proyek_dates&&(r=t.proyek_dates,v())}})}else v()})});
