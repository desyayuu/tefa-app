var r=(d,e)=>()=>(e||d((e={exports:{}}).exports,e),e.exports);var h=r((c,s)=>{class l{constructor(e={}){this.config={containerSelector:"#formBidangKeahlian",submitUrl:e.submitUrl||"",mahasiswaId:e.mahasiswaId||"",csrfToken:e.csrfToken||"",...e},this.bidangKeahlianData=e.bidangKeahlianData||[],this.selectedBidangKeahlian=[],this.filteredData=[...this.bidangKeahlianData],this.elements={},this.init()}init(){if(!this.initializeElements()){console.error("BidangKeahlianManager: Required elements not found");return}this.setupEventListeners(),this.loadInitialData(),this.renderDropdownItems(),this.updateSelectedDisplay(),this.updateHiddenInputs()}initializeElements(){const e={container:this.config.containerSelector,dropdownBidangKeahlian:"#dropdownBidangKeahlian",dropdownMenuBidang:"#dropdownMenuBidang",searchInput:"#searchBidangKeahlian",selectedContainer:"#selectedBidangContainer",bidangCounter:"#bidangCounter",dropdownIcon:"#dropdownIcon",hiddenInputsContainer:"#hiddenBidangKeahlianInputs",formBidangKeahlian:"#formBidangKeahlian",btnSimpan:"#btnSimpanBidangKeahlian",loadingSpinner:"#loadingSpinner",btnText:"#btnText",alertContainer:"#alertContainer"};for(const[t,n]of Object.entries(e))if(this.elements[t]=document.querySelector(n),!this.elements[t]&&["container","formBidangKeahlian"].includes(t))return!1;return!0}setupEventListeners(){this.elements.formBidangKeahlian&&this.elements.formBidangKeahlian.addEventListener("submit",e=>{e.preventDefault(),this.submitBidangKeahlian()}),this.elements.dropdownBidangKeahlian&&this.elements.dropdownBidangKeahlian.addEventListener("click",e=>{e.target!==this.elements.searchInput&&this.toggleDropdown()}),this.elements.searchInput&&(this.elements.searchInput.addEventListener("input",e=>{this.filterBidangKeahlian(e.target.value)}),this.elements.searchInput.addEventListener("focus",()=>{this.showDropdown()}),this.elements.searchInput.addEventListener("keydown",e=>{e.key==="Escape"&&this.hideDropdown()})),document.addEventListener("click",e=>{this.elements.dropdownBidangKeahlian&&this.elements.dropdownMenuBidang&&!this.elements.dropdownBidangKeahlian.contains(e.target)&&!this.elements.dropdownMenuBidang.contains(e.target)&&this.hideDropdown()})}loadInitialData(){this.config.initialSelectedBidangKeahlian&&this.config.initialSelectedBidangKeahlian.length>0&&(this.selectedBidangKeahlian=this.config.initialSelectedBidangKeahlian.map(e=>({id:e.bidang_keahlian_id,nama:e.nama_bidang_keahlian})))}toggleDropdown(){this.elements.dropdownMenuBidang.style.display==="none"?this.showDropdown():this.hideDropdown()}showDropdown(){!this.elements.dropdownMenuBidang||!this.elements.dropdownBidangKeahlian||!this.elements.dropdownIcon||(this.elements.dropdownMenuBidang.style.display="block",this.elements.dropdownBidangKeahlian.classList.add("active"),this.elements.dropdownIcon.classList.replace("fa-chevron-down","fa-chevron-up"))}hideDropdown(){!this.elements.dropdownMenuBidang||!this.elements.dropdownBidangKeahlian||!this.elements.dropdownIcon||(this.elements.dropdownMenuBidang.style.display="none",this.elements.dropdownBidangKeahlian.classList.remove("active"),this.elements.dropdownIcon.classList.replace("fa-chevron-up","fa-chevron-down"),this.elements.searchInput&&(this.elements.searchInput.value=""),this.filteredData=[...this.bidangKeahlianData],this.renderDropdownItems())}filterBidangKeahlian(e){this.filteredData=this.bidangKeahlianData.filter(t=>t.nama_bidang_keahlian.toLowerCase().includes(e.toLowerCase())&&!this.selectedBidangKeahlian.some(n=>n.id===t.bidang_keahlian_id)),this.renderDropdownItems(),this.showDropdown()}renderDropdownItems(){if(!this.elements.dropdownMenuBidang)return;const e=this.filteredData.filter(t=>!this.selectedBidangKeahlian.some(n=>n.id===t.bidang_keahlian_id));if(e.length===0){this.elements.dropdownMenuBidang.innerHTML=`
                <div class="dropdown-item-bidang disabled">
                    <i class="fas fa-search me-2"></i>
                    Tidak ada bidang keahlian yang tersedia
                </div>
            `;return}this.elements.dropdownMenuBidang.innerHTML=e.map(t=>`
            <button class="dropdown-item-bidang" 
                    data-bidang-id="${t.bidang_keahlian_id}" 
                    data-bidang-nama="${this.escapeHtml(t.nama_bidang_keahlian)}">
                <i class="fas fa-plus-circle me-2 text-success"></i>
                ${this.escapeHtml(t.nama_bidang_keahlian)}
            </button>
        `).join(""),this.elements.dropdownMenuBidang.querySelectorAll(".dropdown-item-bidang:not(.disabled)").forEach(t=>{t.addEventListener("click",n=>{n.preventDefault();const a=t.getAttribute("data-bidang-id"),i=t.getAttribute("data-bidang-nama");this.addBidangKeahlian(a,i)})})}addBidangKeahlian(e,t){this.selectedBidangKeahlian.some(n=>n.id===e)||(this.selectedBidangKeahlian.push({id:e,nama:t}),this.updateSelectedDisplay(),this.updateHiddenInputs(),this.renderDropdownItems(),this.elements.searchInput&&(this.elements.searchInput.value="",this.elements.searchInput.focus()),this.triggerEvent("bidangKeahlianAdded",{id:e,nama:t}))}removeBidangKeahlian(e){const t=this.selectedBidangKeahlian.find(n=>n.id===e);this.selectedBidangKeahlian=this.selectedBidangKeahlian.filter(n=>n.id!==e),this.updateSelectedDisplay(),this.updateHiddenInputs(),this.renderDropdownItems(),t&&this.triggerEvent("bidangKeahlianRemoved",t)}updateSelectedDisplay(){this.elements.selectedContainer&&(this.selectedBidangKeahlian.length===0?(this.elements.selectedContainer.innerHTML=`
                <div class="empty-state">
                    <i class="fas fa-plus-circle me-2"></i>
                    Belum ada bidang keahlian yang dipilih
                </div>
            `,this.elements.selectedContainer.classList.remove("has-items")):(this.elements.selectedContainer.innerHTML=this.selectedBidangKeahlian.map(e=>`
                <span class="bidang-keahlian-tag">
                    <i class="fas fa-code me-2"></i>
                    ${this.escapeHtml(e.nama)}
                    <button class="remove-tag" 
                            data-bidang-id="${e.id}" 
                            title="Hapus">
                        <i class="fas fa-times"></i>
                    </button>
                </span>
            `).join(""),this.elements.selectedContainer.classList.add("has-items"),this.elements.selectedContainer.querySelectorAll(".remove-tag").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const n=e.getAttribute("data-bidang-id");this.removeBidangKeahlian(n)})})),this.elements.bidangCounter&&(this.elements.bidangCounter.textContent=this.selectedBidangKeahlian.length))}updateHiddenInputs(){this.elements.hiddenInputsContainer&&(this.elements.hiddenInputsContainer.innerHTML="",this.selectedBidangKeahlian.forEach(e=>{const t=document.createElement("input");t.type="hidden",t.name="bidang_keahlian[]",t.value=e.id,this.elements.hiddenInputsContainer.appendChild(t)}))}async submitBidangKeahlian(){if(!this.config.mahasiswaId){this.showAlert("error","ID Mahasiswa tidak ditemukan");return}this.setLoadingState(!0),this.clearAlerts();try{const e=new FormData;this.config.csrfToken&&e.append("_token",this.config.csrfToken),e.append("_method","PUT"),this.selectedBidangKeahlian.forEach(a=>{e.append("bidang_keahlian[]",a.id)});const n=await(await fetch(this.config.submitUrl,{method:"POST",body:e,headers:{"X-Requested-With":"XMLHttpRequest"}})).json();n.status==="success"?(this.showAlert("success",n.message),this.triggerEvent("bidangKeahlianSaved",{data:n.data,selectedItems:[...this.selectedBidangKeahlian]})):(this.showAlert("error",n.message||"Terjadi kesalahan saat menyimpan data"),n.errors&&console.error("Validation errors:",n.errors))}catch(e){console.error("Error:",e),this.showAlert("error","Terjadi kesalahan saat menghubungi server")}finally{this.setLoadingState(!1)}}setLoadingState(e){!this.elements.btnSimpan||!this.elements.loadingSpinner||!this.elements.btnText||(this.elements.btnSimpan.disabled=e,e?(this.elements.loadingSpinner.classList.remove("d-none"),this.elements.btnText.textContent="Menyimpan..."):(this.elements.loadingSpinner.classList.add("d-none"),this.elements.btnText.textContent="Simpan Perubahan"))}showAlert(e,t){if(!this.elements.alertContainer)return;const a=`
            <div class="alert ${e==="success"?"alert-success":e==="warning"?"alert-warning":"alert-danger"} alert-dismissible fade show" role="alert">
                ${this.escapeHtml(t)}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        `;this.elements.alertContainer.innerHTML=a,setTimeout(()=>{const i=this.elements.alertContainer.querySelector(".alert");i&&(i.classList.remove("show"),setTimeout(()=>{this.elements.alertContainer.innerHTML=""},150))},5e3)}clearAlerts(){this.elements.alertContainer&&(this.elements.alertContainer.innerHTML="")}reset(){this.selectedBidangKeahlian=[],this.updateSelectedDisplay(),this.updateHiddenInputs(),this.renderDropdownItems(),this.clearAlerts(),this.triggerEvent("bidangKeahlianReset")}setBidangKeahlian(e){this.selectedBidangKeahlian=[],e.forEach(t=>{const n=this.bidangKeahlianData.find(a=>a.bidang_keahlian_id===t);n&&this.selectedBidangKeahlian.push({id:n.bidang_keahlian_id,nama:n.nama_bidang_keahlian})}),this.updateSelectedDisplay(),this.updateHiddenInputs(),this.renderDropdownItems(),this.triggerEvent("bidangKeahlianSet",{ids:e})}getSelectedBidangKeahlian(){return[...this.selectedBidangKeahlian]}updateData(e){this.bidangKeahlianData=e||[],this.filteredData=[...this.bidangKeahlianData],this.renderDropdownItems()}escapeHtml(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(n){return t[n]})}triggerEvent(e,t={}){if(this.elements.container){const n=new CustomEvent(e,{detail:t,bubbles:!0,cancelable:!0});this.elements.container.dispatchEvent(n)}}destroy(){this.elements.container&&(this.elements.container.innerHTML=""),this.elements={},this.selectedBidangKeahlian=[],this.bidangKeahlianData=[],this.filteredData=[]}}typeof s<"u"&&s.exports?s.exports=l:typeof window<"u"&&(window.BidangKeahlianManager=l)});export default h();
