import{s}from"./components-C-5l6dZl.js";$(document).ready(function(){new URLSearchParams(window.location.search).get("scroll_to")==="portofolio"&&setTimeout(function(){const o=document.getElementById("section-portofolio");o&&o.scrollIntoView({behavior:"smooth",block:"start"})},500);let n;setTimeout(function(){try{const o=document.getElementById("modalEditPortofolio");o&&typeof bootstrap<"u"?n=new bootstrap.Modal(o,{backdrop:"static",keyboard:!1}):(console.warn("Bootstrap not available or modal element not found"),n=null)}catch(o){console.error("Bootstrap modal initialization failed:",o),n=null}},100),$(document).on("click",".btn-edit",function(o){o.preventDefault(),o.stopPropagation();const t=$(this).data("id");if(!t){console.error("ID tidak ditemukan"),s.errorMessage("ID tidak ditemukan");return}$.ajax({url:`/mahasiswa/portofolio/detail/${t}`,type:"GET",success:function(a){if(a.status==="success"){const e=a.data;if($("#modalEditPortofolio").length===0){console.error("Modal element not found in DOM"),s.errorMessage("Modal tidak ditemukan");return}$("#formEditPortofolio")[0].reset(),$("#edit_id").val(e.portofolio_id),$("#edit_nama_kegiatan").val(e.nama_kegiatan),$("#edit_jenis_kegiatan").val(e.jenis_kegiatan),$("#edit_penyelenggara").val(e.penyelenggara||""),$("#edit_tingkat_kegiatan").val(e.tingkat_kegiatan),$("#edit_peran_dalam_kegiatan").val(e.peran_dalam_kegiatan||""),$("#edit_link_kegiatan").val(e.link_kegiatan||""),$("#edit_deskripsi_kegiatan").val(e.deskripsi_kegiatan||"");const r=`/mahasiswa/portofolio/update/${t}`;$("#formEditPortofolio").attr("action",r),u()}else console.error("Response error:",a.message),s.errorMessage("Error: "+a.message)},error:function(a,e,i){console.error("AJAX Error details:",{xhr:a,status:e,error:i,responseText:a.responseText,statusCode:a.status});let r="Error loading data";a.responseJSON&&a.responseJSON.message?r=a.responseJSON.message:a.status===404?r="Data tidak ditemukan atau Anda tidak memiliki akses":a.status===401?(r="Sesi telah berakhir. Silakan login kembali",setTimeout(()=>{window.location.href="/login"},2e3)):a.status===500?r="Server error":a.status===0&&(r="Network error atau route tidak ditemukan"),s.errorMessage(r)}})});function u(){let o=!1;if(n&&!o)try{n.show(),o=!0}catch(t){console.error("Bootstrap modal show error:",t)}if(!o)try{$("#modalEditPortofolio").modal("show"),o=!0}catch(t){console.error("jQuery modal show error:",t)}o||(console.error("All modal show methods failed"),s.errorMessage("Gagal menampilkan modal edit"))}$(document).on("click",".btn-delete",function(o){o.preventDefault(),o.stopPropagation();const t=$(this).data("id");if(!t){s.errorMessage("ID tidak ditemukan");return}s.confirmationDelete("Apakah Anda yakin ingin menghapus data portofolio ini?").then(a=>{a.isConfirmed&&p(t)})});function p(o){$(`.btn-delete[data-id="${o}"]`).prop("disabled",!0).html('<i class="fas fa-spinner fa-spin"></i>'),$.ajax({url:`/mahasiswa/portofolio/delete/${o}`,type:"DELETE",data:{_token:$('meta[name="csrf-token"]').attr("content")},success:function(t){t.status==="success"?(s.successMessage("Data portofolio berhasil dihapus"),setTimeout(()=>{const a=new URL(window.location);a.searchParams.set("scroll_to","portofolio"),window.location.href=a.toString()},1500)):s.errorMessage(t.message)},error:function(t,a,e){console.error("Error deleting data:",t);let i="Error deleting data";t.responseJSON&&t.responseJSON.message?i=t.responseJSON.message:t.status===401&&(i="Sesi telah berakhir. Silakan login kembali",setTimeout(()=>{window.location.href="/login"},2e3)),s.errorMessage(i)},complete:function(){$(`.btn-delete[data-id="${o}"]`).prop("disabled",!1).html('<i class="fas fa-trash"></i>')}})}$(document).on("click",'[data-bs-dismiss="modal"]',function(){$(this).closest(".modal").attr("id")==="modalEditPortofolio"&&f()});function f(){try{n?n.hide():$("#modalEditPortofolio").modal("hide")}catch{$("#modalEditPortofolio").removeClass("show").css("display","none"),$("body").removeClass("modal-open").css("padding-right",""),$(".modal-backdrop").remove()}}$("#formTambahPortofolio").on("submit",function(o){o.preventDefault();const t=$(this).find('button[type="submit"]'),a=t.html();t.prop("disabled",!0).html('<i class="fas fa-spinner fa-spin me-1"></i>Menyimpan...'),$.ajax({url:$(this).attr("action"),type:"POST",data:$(this).serialize(),beforeSend:function(){$("#alertContainerPortofolio").html("")},success:function(e){e.status==="success"?($("#modalTambahPortofolio").modal("hide"),s.successMessage("Data portofolio berhasil ditambahkan"),setTimeout(()=>{const i=new URL(window.location);i.searchParams.set("scroll_to","portofolio"),window.location.href=i.toString()},1500)):s.errorMessage(e.message)},error:function(e,i,r){var l;if(console.error("Error saving data:",e),e.status===422){const d=e.responseJSON.errors;let c=`Kesalahan Validasi:
`;for(let m in d)c+="• "+d[m][0]+`
`;s.errorMessage(c)}else e.status===401?(s.errorMessage("Sesi telah berakhir. Silakan login kembali"),setTimeout(()=>{window.location.href="/login"},2e3)):s.errorMessage("Error saving data: "+(((l=e.responseJSON)==null?void 0:l.message)||r))},complete:function(){t.prop("disabled",!1).html(a)}})}),$("#formEditPortofolio").on("submit",function(o){o.preventDefault();const t=$(this).find('button[type="submit"]'),a=t.html();t.prop("disabled",!0).html('<i class="fas fa-spinner fa-spin me-1"></i>Menyimpan...'),$.ajax({url:$(this).attr("action"),type:"POST",data:$(this).serialize(),success:function(e){e.status==="success"?(f(),s.successMessage("Data portofolio berhasil diperbarui"),setTimeout(()=>{const i=new URL(window.location);i.searchParams.set("scroll_to","portofolio"),window.location.href=i.toString()},1500)):s.errorMessage(e.message)},error:function(e,i,r){var l;if(console.error("Error updating data:",e),e.status===422){const d=e.responseJSON.errors;let c=`Kesalahan Validasi:
`;for(let m in d)c+="• "+d[m][0]+`
`;s.errorMessage(c)}else e.status===401?(s.errorMessage("Sesi telah berakhir. Silakan login kembali"),setTimeout(()=>{window.location.href="/login"},2e3)):s.errorMessage("Error updating data: "+(((l=e.responseJSON)==null?void 0:l.message)||r))},complete:function(){t.prop("disabled",!1).html(a)}})}),$("#modalTambahPortofolio").on("hidden.bs.modal",function(){$("#formTambahPortofolio")[0].reset(),$(this).find('button[type="submit"]').prop("disabled",!1).html('<i class="fas fa-save me-1"></i>Simpan')}),$("#modalEditPortofolio").on("hidden.bs.modal",function(){$("#formEditPortofolio")[0].reset(),$(this).find('button[type="submit"]').prop("disabled",!1).html('<i class="fas fa-save me-1"></i>Simpan Perubahan')}),$('#searchPortofolioForm input[name="search_portofolio"]').on("keypress",function(o){o.which===13&&$(this).closest("form").submit()}),$("#modalTambahPortofolio").on("shown.bs.modal",function(){$("#nama_kegiatan").focus()}),$("#modalEditPortofolio").on("shown.bs.modal",function(){$("#edit_nama_kegiatan").focus()})});
